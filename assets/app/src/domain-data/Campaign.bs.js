// Generated by BUCKLESCRIPT VERSION 3.0.0, PLEASE EDIT WITH CARE
'use strict';

var $$Array = require("bs-platform/lib/js/array.js");
var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Belt_MapInt = require("bs-platform/lib/js/belt_MapInt.js");
var Json_decode = require("@glennsl/bs-json/src/Json_decode.bs.js");
var Util$ReactTemplate = require("../Util.bs.js");

function decodeCampaign(json) {
  return /* record */[
          /* id */Json_decode.field("id", Json_decode.$$int, json),
          /* name */Json_decode.field("name", Json_decode.string, json),
          /* description */Json_decode.field("description", Json_decode.string, json),
          /* system_id */Json_decode.field("system_id", Json_decode.$$int, json)
        ];
}

function decodeCampaigns(json) {
  return Json_decode.list(decodeCampaign, json);
}

function encodeString(key, value, dict) {
  dict[key] = value;
  return dict;
}

function encodeInt(key, value, dict) {
  dict[key] = value;
  return dict;
}

function encodeDraftCampaign(draftCampaign) {
  return encodeInt("system_id", draftCampaign[/* system_id */2], encodeString("description", draftCampaign[/* description */1], encodeString("name", draftCampaign[/* name */0], { })));
}

function encodeCampaign(campaign) {
  return encodeInt("system_id", campaign[/* system_id */3], encodeString("description", campaign[/* description */2], encodeString("name", campaign[/* name */1], encodeInt("id", campaign[/* id */0], { }))));
}

function getCampaigns() {
  return Util$ReactTemplate.JsonApi[/* get */0]("/api/campaigns", decodeCampaigns);
}

function createCampaign(draftCampaign) {
  var campaignDict = encodeDraftCampaign(draftCampaign);
  var payload = { };
  payload["campaign"] = campaignDict;
  return Util$ReactTemplate.JsonApi[/* post */1]("/api/campaigns", payload, decodeCampaign);
}

function updateCampaign(campaign) {
  var campaignDict = encodeCampaign(campaign);
  var payload = { };
  payload["campaign"] = campaignDict;
  return Util$ReactTemplate.JsonApi[/* put */2]("/api/campaigns", payload, decodeCampaign);
}

var Api = /* module */[
  /* decodeCampaign */decodeCampaign,
  /* decodeCampaigns */decodeCampaigns,
  /* encodeString */encodeString,
  /* encodeInt */encodeInt,
  /* encodeDraftCampaign */encodeDraftCampaign,
  /* encodeCampaign */encodeCampaign,
  /* getCampaigns */getCampaigns,
  /* createCampaign */createCampaign,
  /* updateCampaign */updateCampaign
];

function reducer(action, state) {
  if (typeof action === "number") {
    return /* SideEffects */Block.__(1, [(function (self) {
                  Util$ReactTemplate.JsonApi[/* get */0]("/api/campaigns", decodeCampaigns).then((function (campaigns) {
                          Curry._1(self[/* send */3], /* GetCampaignsSuccess */Block.__(0, [campaigns]));
                          return Promise.resolve(/* () */0);
                        }));
                  return /* () */0;
                })]);
  } else {
    switch (action.tag | 0) {
      case 0 : 
          return /* Update */Block.__(0, [Belt_MapInt.fromArray($$Array.map((function (c) {
                                return /* tuple */[
                                        c[/* id */0],
                                        c
                                      ];
                              }), $$Array.of_list(action[0])))]);
      case 1 : 
          var draftCampaign = action[0];
          return /* SideEffects */Block.__(1, [(function (self) {
                        createCampaign(draftCampaign).then((function (campaign) {
                                Curry._1(self[/* send */3], /* CreateCampaignSuccess */Block.__(2, [campaign]));
                                return Promise.resolve(/* () */0);
                              }));
                        return /* () */0;
                      })]);
      case 2 : 
          var campaign = action[0];
          return /* Update */Block.__(0, [Belt_MapInt.set(state, campaign[/* id */0], campaign)]);
      
    }
  }
}

var initialState = /* None */0;

exports.Api = Api;
exports.initialState = initialState;
exports.reducer = reducer;
/* Util-ReactTemplate Not a pure module */
